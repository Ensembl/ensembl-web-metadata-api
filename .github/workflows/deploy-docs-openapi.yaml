name: Deploy API Docs
on:
  push:
    branches: [main]
    paths: ['APISpecification.yaml']  # Only run when spec changes

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create documentation page
        run: |
          cat > index.html << 'EOF'
          <!DOCTYPE html>
          <html>
            <head>
              <title>API Documentation</title>
              <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@3/swagger-ui.css" />
            </head>
            <body>
              <div id="swagger-ui"></div>
              <script src="https://unpkg.com/swagger-ui-dist@3/swagger-ui-bundle.js"></script>
              <script>
                SwaggerUIBundle({
                  url: './APISpecification.yaml',
                  dom_id: '#swagger-ui',
                  presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIBundle.presets.standalone
                  ]
                });
              </script>
            </body>
          </html>
          EOF

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          publish_branch: gh-pages